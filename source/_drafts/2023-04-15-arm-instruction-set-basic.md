---
title: ARM汇编概述
date: 2023-04-15 21:30:14
tags:
 - 笔记
categories:
 - 笔记
description: 汇编语言程序设计—基于ARM体系结构(第3版)第三章笔记
---

## 概述

本文希望能够对ARM汇编语言的形式，以及少数相关的指令集内容进行部分地介绍，目的是让读者对ARM汇编相对其它汇编语言的特点有所了解，帮助进行更进一步的学习。

本文仅限于形式，不具体介绍有哪些指令。

## 条件码

ARM指令集中，机器指令有4位被称为“条件码”，用来表示这条指令在什么条件下执行，即指令只会在状态寄存器内容满足条件码对应条件时才会执行。条件码反映在汇编指令上时，表现为这些指令可以加上一些（与条件码对应）的后缀，以形成一个新的、仅在特定条件下执行指令。

例如加法指令`ADD`，原本是无条件执行的，但如果加上后缀`EQ`变成`ADDEQ`，就会变成“仅在状态寄存器Z标志置位时执行加法”指令。

## S后缀

与上述的条件码类似，ARM指令也可以加一个`S`后缀形成一个新的指令。拥有`S`后缀的指令会根据其执行结果改变状态寄存器的值，没有这个后缀则不会改变。但是一些专门用来改变状态寄存器的指令，例如`CMP`，则不符合这个规律。

例如减法指令`SUB`，原本它并不会改变状态寄存器，但如果变成`SUBS`，那么它就会影响状态寄存器的值。

此外，S后缀和条件码很多时候是不冲突的，例如可以有`SUBEQS`

## 通用寄存器

ARM处理器中包含31个32位通用寄存器，但这些寄存器往往不能被同时使用，用户一般只能通过`R0`-`R15`这16个标识索引其中若干寄存器。

在这16个标识中，`R0`-`R7`被称为未分类寄存器。对于每个未分类寄存器，不论在什么处理器工作模式下，它都始终表示同一个物理位置；相对地，`R8`-`R14`是分类寄存器。对于每个分类寄存器，在不同的处理器工作模式下，它可能表示不同的物理位置。

特别地，`R15`被用作程序计数器PC，尽管它也是通用寄存器之一。

## 移位指令

ARM架构的一个特点是，操作数在送到ALU之前就可以被移位。这意味着在ARM指令中，移位操作不是作为单独的指令、而是作为其它指令中操作数的“修饰符”出现的。

ARM指令的移位操作形式为`寄存器,移位指令<立即数>`。例如，有一个指令的一个操作数为`R0`，如果将其改成“`R0`逻辑左移一位的值”，那么就可以将这个操作数换成`R0,LCL#1`

## 地址表达式

在ARM的数据加载和存储指令中，可以使用`寄存器+偏移量`的方式进行基址寻址，其中偏移量可以是立即数、寄存器等内容。在指令中表示这种寻址的方式为地址表达式。例如，对于数据加载指令`LDR`，其格式为`LDR 寄存器 地址表达式`

地址表达式有三种类型：
 - 前索引：形式为`[寄存器,偏移量]`。表示的地址就是`寄存器+偏移量`，且不会改变寄存器本身的值。
 - 自动索引：形式为`[寄存器,偏移量]!`，即比前索引多了一个`!`后缀。工作方式也与前索引相似，但不同之处是，自动索引会把寄存器的内容改为偏移后的地址。
 - 后索引：形式为`[寄存器],偏移量`。表示的地址是寄存器的值，在寻址后会将寄存器的内容加上偏移量。

感性地理解，自动索引就是C语言里地`++p`，后索引就是`p++`。

## 参考文献

 - 文全刚, 郝志刚. 汇编语言程序设计—基于ARM体系结构(第3版). 北京航空航天大学出版社